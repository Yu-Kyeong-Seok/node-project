contents<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/static/styles/common/header.css" />
    <link rel="stylesheet" href="/static/styles/common/footer.css" />
    <link rel="stylesheet" href="/static/styles/post/postDetail.css" />
    <link rel="stylesheet" href="/static/styles/common/reset.css" />
    <link
      rel="stylesheet"
      as="style"
      crossorigin
      href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable.min.css"
    />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script
      src="https://kit.fontawesome.com/5a10cda3a0.js"
      crossorigin="anonymous"
    ></script>

    <title>Document</title>
  </head>

  <body>
    @media (min-width: 300px) and (max-width: 890px)
    <div class="page-container">
      <%- include('../_layouts/header') %>

      <div class="content">
        <div class="detail-category">
          <h2 class="category-title"><%= post.category %></h2>
          <div class="profile-bar">
            <div class="detail-profile">
              <!-- 프로필 더미 2배 키움 -->
              <i class="fa-solid fa-user fa-2x"></i>
            </div>
            <div class="detail-user">
              <div class="detail-nickName">닉네임</div>
              <div class="detail-date">
                <% const formattedDate = new
                Date(post.createdAt).toISOString().slice(0, 10);%>
                <p>작성일: <%= formattedDate %></p>
              </div>
            </div>
          </div>
          <div class="tool">
            <button class="tool-button">수정</button>
            <button class="tool-button">삭제</button>
          </div>
        </div>

        <div class="contents-container">
          <div class="contents-title">
            <h3><%= post.title %></h3>
          </div>
          <div class="contents">
            <p><%= post.content %></p>
          </div>
          <div class="contents-bottom">
            <button class="thumbs-up hello">
              <!-- 색 있는거 -->
              <i class="fa-solid fa-thumbs-up fa-2x"></i>
              <!-- 색 없는거  내일 물어봐야 함-->
              <!-- <i class="fa-regular fa-thumbs-up"></i> -->
            </button>
            <button class="thumbs-down hello">
              <!-- 색 있는거 -->
              <i class="fa-solid fa-thumbs-down fa-2x"></i>
              <!-- 색 없는거  내일 물어봐야 함-->
              <!-- <i class="fa-regular fa-thumbs-down"></i> -->
            </button>
          </div>
        </div>

        <div class="comment-container">
          <div class="comment-logOut">
            <div class="comment-profile">
              <i class="fa-solid fa-user"></i>
            </div>
            <div class="comment-contants">
              <p>
                댓글을 등록하려면
                <a href="/login" class="need-login">로그인</a>이 필요합니다.
              </p>
            </div>
          </div>
          <div class="comment-login">
            <div class="commet-login-up">
              <div class="comment-profile">
                <i class="fa-solid fa-user"></i>
              </div>
              <div class="login-comment-contants">
                <textarea
                  name=""
                  id="comment-textarea"
                  placeholder="당신의 의견을 들려주세요"
                ></textarea>
              </div>
            </div>
            <div class="comment-login-down">
              <button type="submit" class="registration">등 록</button>
            </div>
          </div>
        </div>
      </div>

      <footer><%- include('../_layouts/footer') %></footer>
      <script>
       // const [cookies] = useCookies(["accessToken"]);
       document.addEventListener("DOMContentLoaded", () => {
  const comment = document.getElementById('comment-textarea');
  const commentBtn = document.querySelector('.registration');

  // 댓글 텍스트박스가 제대로 선택되었는지 확인
  if (comment) {
    console.log('댓글 입력 텍스트박스:', comment);
  } else {
    console.error('댓글 입력 텍스트박스를 찾을 수 없습니다.');
  }

  // 버튼 이벤트 리스너 설정
  commentBtn.addEventListener("click", async (event) => {
    event.preventDefault();  // 기본 동작을 막음
    console.log('댓글 등록 버튼 클릭됨');
    
    try {
      const url = window.location.pathname; // "/views/post/detail/66f497c2f7319653c4f4505f"
    const postId = url.split("/").pop();  // 마지막 값을 추출

      const res = await fetch(`/api/posts/${postId}/comments`, {
        method: "POST",
        body: JSON.stringify({
          content: comment.value,
        }),
        headers: {
          "Content-Type": "application/json"
        }
      });
      
      const data = await res.json();
      console.log('서버 응답 데이터:', data);
      
      if (!res.ok) {
        throw new Error(data.details);
      }

      alert('댓글이 성공적으로 등록되었습니다.');
    } catch (error) {
      alert('댓글 등록에 실패하였습니다. ' + error.message);
    }
  });
});


        // const handleComment = () => {
        //   if (!cookies.accessToken) {
        //     alert("로그인필요");
        //     return;
        //   }
        // };
        $(document).ready(function () {
          $(".hamburger-bar").click(function () {
            $("#menu, .page_cover").addClass("open");
          });

          $(".page_cover, .close").click(function () {
            $("#menu, .page_cover").removeClass("open");
          });
          //로그인 관련
          const login = $(".comment-login");
          const logout = $(".comment-logOut");
          const accessToken = document.cookie
            .split("; ")
            .find((index) => index.startsWith("accessToken="));
          const isLoggedIn = !!accessToken;
      //로그인시 이렇게 됩니다
      if (isLoggedIn) {
            login.css("display", "block");
            logout.css("display", "none");
          }
        });

        const [cookies] = useCookies(["accessToken"]);

        const handleComment = () => {
          if (!cookies.accessToken) {
            alert("로그인필요");
            return;
          }
        }
  
    
      </script>
    </div>
  </body>
</html>
