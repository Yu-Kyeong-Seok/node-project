contents<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/static/styles/common/header.css" />
    <link rel="stylesheet" href="/static/styles/common/footer.css" />
    <link rel="stylesheet" href="/static/styles/post/postDetail.css" />
    <link rel="stylesheet" href="/static/styles/common/reset.css" />
    <link
      rel="stylesheet"
      as="style"
      crossorigin
      href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable.min.css"
    />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script
      src="https://kit.fontawesome.com/5a10cda3a0.js"
      crossorigin="anonymous"
    ></script>

    <title>Document</title>
  </head>

  <body>
    @media (min-width: 300px) and (max-width: 890px)
    <div class="page-container">
      <%- include('../_layouts/header') %>

      <div class="content">
        <div class="detail-category">
          <h2 class="category-title"><%= post.category %></h2>
          <div class="profile-bar">
            <div class="detail-profile">
              <!-- 프로필 더미 2배 키움 -->
              <i class="fa-solid fa-user fa-2x"></i>
            </div>
            <div class="detail-user">
              <div class="detail-nickName">닉네임</div>
              <div class="detail-date">
                <% 
                  const createdAt = post.createdAt;
                  let formattedDate = "날짜 없음"; // 기본값 설정
                  if (createdAt) {
                    const date = new Date(createdAt);
                    if (!isNaN(date)) {
                      formattedDate = date.toISOString().slice(0, 10);
                    }
                  }
                %>
                <p>작성일: <%= formattedDate %></p>
              </div>
            </div>
          </div>
          <div class="tool">
            <button class="tool-button">수정</button>
            <button class="tool-button">삭제</button>
          </div>
        </div>

        <div class="contents-container">
          <div class="contents-title">
            <h3><%= post.title %></h3>
          </div>
          <div class="contents">
            <p><%= post.content %></p>
          </div>
          <div class="contents-bottom">
            <button class="thumbs-up hello">
              <!-- 색 있는거 -->
              <i class="fa-solid fa-thumbs-up fa-2x"></i>
              <!-- 색 없는거  내일 물어봐야 함-->
              <!-- <i class="fa-regular fa-thumbs-up"></i> -->
            </button>
            <button class="thumbs-down hello">
              <!-- 색 있는거 -->
              <i class="fa-solid fa-thumbs-down fa-2x"></i>
              <!-- 색 없는거  내일 물어봐야 함-->
              <!-- <i class="fa-regular fa-thumbs-down"></i> -->
            </button>
          </div>
        </div>

        <div class="comment-container">
          <div class="comment-logOut">
            <div class="comment-profile">
              <i class="fa-solid fa-user"></i>
            </div>
            <div class="comment-contants">
              <p>
                댓글을 등록하려면
                <a href="/login" class="need-login">로그인</a>이 필요합니다.
              </p>
            </div>
          </div>
          <div class="comment-login">
            <div class="commet-login-up" style="border:1px solid red">
              <div class="comment-profile">
                <i class="fa-solid fa-user"></i>
              </div>
              <div class="login-comment-contants">
                <textarea
                  name=""
                  id="comment-textarea"
                  placeholder="당신의 의견을 들려주세요"
                ></textarea>
              </div>
            </div>
            <div class="comment-login-down">
              <button type="submit" class="registration">등 록</button>
            </div>
            <% if (comments && comments.length > 0) { %>
              <% comments.forEach(function(comment) { %>
                <div class="comment">
                  <p><%= comment.content %></p>
                </div>
              <% }); %>
            <% } else { %>
              <p>댓글이 없습니다.</p>
            <% } %>
            
            
          </div>
        </div>
      </div>

      <footer><%- include('../_layouts/footer') %></footer>
      <script>
  $(document).ready(function () {
    // 햄버거 메뉴 관련
    $(".hamburger-bar").click(function () {
      $("#menu, .page_cover").addClass("open");
    });

    $(".page_cover, .close").click(function () {
      $("#menu, .page_cover").removeClass("open");
    });

    // 로그인 관련
    const login = $(".comment-login");
    const logout = $(".comment-logOut");
    const accessToken = document.cookie
      .split("; ")
      .find((index) => index.startsWith("accessToken="));
      console.log('acees',accessToken)
    const isLoggedIn = !!accessToken;

    // 로그인 상태에 따라 표시 제어
    if (isLoggedIn) {
      login.css("display", "block");
      logout.css("display", "none");
    }

    // 댓글 등록 버튼 이벤트 리스너
    $(".registration").click(async function (event) {
      event.preventDefault(); // 기본 동작 막기

      // 로그인 체크
      if (!isLoggedIn) {
        alert("로그인이 필요합니다.");
        return;
      }

      // 댓글 내용 가져오기
      const commentContent = $("#comment-textarea").val();

      // 현재 포스트 ID 가져오기
      const url = window.location.pathname;
      const postId = url.split("/").pop();

      try {
        const res = await fetch(`/api/posts/${postId}/comments`, {
          method: "POST",
          body: JSON.stringify({
            content: commentContent,
          }),
          headers: {
            "Content-Type": "application/json",
            "Authorization": `${accessToken}`,
          },
        });

        const data = await res.json();
        console.log("서버 응답 데이터:", data);

        if (!res.ok) {
          throw new Error(data.details);
        }

        alert("댓글이 성공적으로 등록되었습니다.");
        // 성공 후 입력창 초기화
        $("#comment-textarea").val("");
      } catch (error) {
        alert("댓글 등록에 실패하였습니다: " + error.message);
      }
    });
  });
      </script>
    </div>
  </body>
</html>
